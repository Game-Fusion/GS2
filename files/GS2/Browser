---------------------------------------------------
-- GameStation 2 Browser - Credits:
--  Strafe: CrazedProgrammer
--  Everything Else: Mr_Iron2
---------------------------------------------------

local function powerOff()
  term.setBackgroundColour(colours.grey)
  term.setTextColour(colours.white)
  term.clear()
  term.setCursorPos(1,8)
  center(8,"Shutting Down...")
  sleep(1)
  term.setBackgroundColour(colours.lightGrey)
  term.clear()
  sleep(0.2)
  term.setBackgroundColour(colours.white)
  term.clear()
  sleep(0.1)
  os.shutdown()
end

local function gamesApps()
  term.setBackgroundColour(colours.blue)
  term.clear()
  term.setCursorPos(1,1)
  term.setTextColour(colours.white)

while true do
  programs = fs.list("/GS2/GamesApps")
  term.setCursorPos(1,1)
  term.clear()
  for i=1,#programs do
    term.setTextColour(colours.white)
    term.setCursorPos(1,i-scroll)
    print(programs[i])
  end
  
  if #programs == 0 then
    term.setTextColour(colours.white)
    term.setCursorPos(1,1)
    print("You have no games.")
  end
  
  term.setCursorPos(1,19)
  term.setTextColour(colours.white)
  write("Click a program to run it. Space to exit.")
  
  os.startTimer(0.3)
  event,a,b,c,d = os.pullEvent()
  if (event == "key" and a == 57) then
  menu()
  break
end
  
  if event == "mouse_scroll" then
    scroll = scroll + a
      if scroll > 0 then
        scroll = 0
      end
    end
    
  if event == "mouse_click" then
    if c <= #programs then
    c = c - scroll
    print(programs[c])
    term.setTextColour(colours.white)
    term.clear()
    term.setCursorPos(1,1)
    shell.run("/GS2/GamesApps/"..programs[c])
    end
  end
end
end

local function systemInfo()
  term.setBackgroundColour(colours.red)
  term.setTextColour(colours.white)
  term.clear()
  center(2,"Information")
  center(4,"GS2 Model: GS2 SCPH-30000")
  center(5,"Software version: v1.5")
  center(7,"Credits:")
  center(9,"Programming: TheMrIron2")
  center(10,"Programming: Funey")
  center(11,"Strafe: CrazedProgrammer")
  center(14,"Thank you for using your GS2!")
  center(16,"Click here to go back")

while true do
  local evt, button, x, y = os.pullEvent("mouse_click")
  if y == 16 then menu()
  else -- otherwise, just wait
end
end
end

local function installDisk()
  term.setBackgroundColour(colours.red)
  term.setTextColour(colours.white)
  term.clear()
  while true do if fs.exists("/disk/") then center(8,"Installing...")
  shell.run("cp disk/* GS2/GamesApps/")
  center(10,"Installed!")
  else center(8,"No disk found!")
  sleep(3)
  menu()
end
end

local function settings()
term.setBackgroundColour(colours.green)
term.setTextColour(colours.white)
term.clear()
center(2,"System Settings")
term.setBackgroundColour(colours.red)
center(4," Modify Files ")
term.setBackgroundColour(colours.green)
center(14,"Click here to Quit")

while true do local evt, button, x, y = os.pullEvent()
  if evt == "mouse_click" then
    if y == 4 then
      term.clear()
      term.setCursorPos(1,1)
      shell.run("/rom/programs/shell")
  elseif y == 14 then
    menu()
else
end
end
end
end

local function updater()
  local w,h = term.getSize()
  term.setBackgroundColour(colours.red)
  term.clear()
  term.setBackgroundColour(colours.white)
  term.setCursorPos(1,1)
  term.clearLine()
  term.setTextColour(colours.blue)
  center(1,"GameStation 2 Updater v1")
  term.setBackgroundColour(colours.red)
  term.setTextColour(colours.white)
  term.setCursorPos(1,3)
  print("   Install")
  print("   Exit")
  center(7,"To update, get an official GS2 update disk.")
  center(8,"disk and press 'Install'.")

while true do local evt, button, x, y = os.pullEvent("mouse_click")
  if y == 3 then
  if not fs.exists("/disk/.flashUpdate/") then  -- Used for disk updates or other purposes to install code
  center(8,"Invalid Disk!")
  menu()
  elseif fs.exists("disk/boot.elf") then shell.run("disk/boot.elf") -- Run a game
  elseif fs.exists("/disk/.flashUpdate/") and fs.isDir("/disk/.flashUpdate") then
  for i,v in pairs(fs.list("/")) do
    if v == "rom" then
    elseif v == "disk" then
    elseif v == "moarp" then
    else
      fs.delete("/"..v)
    end
  end
  shell.run("cp /disk/.flashUpdate/* /")
  end
  term.clear()
  centerSlow(8,"Installed!")
  sleep(0.9)
  menu()
   elseif y == 4 then menu()
    else end
     end
    end
   end
  end
  
local function menu()
  term.setBackgroundColour(colours.red)
  term.clear()
  term.setCursorPos(1,1)
  term.setBackgroundColour(colours.white)
  term.clearLine()
  term.setTextColour(colours.red)
  center(1,"GameStation 2 Browser")
  term.setBackgroundColour(colours.red)
  term.setCursorPos(1,3)
  term.setTextColour(colours.blue)
  term.setBackgroundColour(colours.white)
  center(3," Games and Apps ")
  center(5," Install ")
  center(7," Strafe ")
  center(9," Shutdown ")
  center(11," Information ")
  center(13," Settings ")
  center(15," Software Update ")
  
  while true do local evt, button, x, y = os.pullEvent("mouse_click")
  if y == 3 then gamesApps()
  elseif y == 5 then installDisk()
  elseif y == 7 then shell.run("pastebin run bj3qj1Pj")
  elseif y == 9 then powerOff()
  elseif y == 11 then systemInfo()
  elseif y == 13 then settings()
  elseif y == 15 then updater()
end
end

menu()
